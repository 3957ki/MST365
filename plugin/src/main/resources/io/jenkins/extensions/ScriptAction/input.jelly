<?jelly escape-by-default='true' encoding='UTF-8'?>
<j:jelly xmlns:j="jelly:core"
         xmlns:st="jelly:stapler"
         xmlns:l="/lib/layout"
         xmlns:f="/lib/form">

    <l:layout permission="ADMINISTER">
        <l:head>
            <link rel="stylesheet"
                  href="${rootURL}/plugin/playwright-e2e-test/io/jenkins/extensions/ScriptAction/input.css"
                  type="text/css"/>
            <script src="${rootURL}/plugin/playwright-e2e-test/io/jenkins/extensions/ScriptAction/input.js"
                    type="text/javascript"></script>
        </l:head>

        <l:main-panel>
            <j:set var="m" value="${it.getIt(request.getParameter('script'))}"/>

            <h1 style="margin-bottom:24px;">
                ${m.title ?: 'ÏÉà Ïä§ÌÅ¨Î¶ΩÌä∏'}
            </h1>

            <f:form method="post" action="save" crumb="true">
                <!-- Ï†úÎ™© -->
                <f:entry title="Ïä§ÌÅ¨Î¶ΩÌä∏ Ï†úÎ™©">
                    <f:textbox name="title"
                               id="scriptTitle"
                               style="width:100%;"
                               value="${m.title}"/>
                </f:entry>

                <!-- üîΩ ÌòïÏãù ÏÑ†ÌÉù ÎìúÎ°≠Îã§Ïö¥ -->
                <f:entry title="ÏûÖÎ†• ÌòïÏãù ÏÑ†ÌÉù">
                    <f:select name="format" id="formatSelector">
                        <f:option value="json" selected="true">JSON</f:option>
                        <f:option value="txt">TXT</f:option>
                    </f:select>
                </f:entry>

                <!-- ÏãúÎÇòÎ¶¨Ïò§ ÌÖúÌîåÎ¶ø -->
                <div id="scenario-template" style="display:none">
                    <div class="scenario">
                        <div>
                            <label>ÏãúÎÇòÎ¶¨Ïò§ Ï†úÎ™©:
                                <input type="text" class="sc-title"/>
                            </label>
                        </div>
                        <div class="steps">
                            <div>
                                <label>Ïä§ÌÖù:
                                    <input type="text" class="st-text"/>
                                </label>
                                <button type="button" class="del-step">‚úï</button>
                            </div>
                        </div>
                        <button type="button" class="add-step">+ Ïä§ÌÖù Ï∂îÍ∞Ä</button>
                        <button type="button" class="del-scenario">‚úï ÏãúÎÇòÎ¶¨Ïò§ ÏÇ≠Ï†ú</button>
                    </div>
                </div>

                <!-- üîò JSON ÏóêÎîîÌÑ∞ -->
                <div id="editor">
                    <j:forEach items="${m.scenarios}" var="sc">
                        <div class="scenario">
                            <div>
                                <label>ÏãúÎÇòÎ¶¨Ïò§ Ï†úÎ™©:
                                    <input type="text" class="sc-title" value="${sc.title}"/>
                                </label>
                            </div>
                            <div class="steps">
                                <j:forEach items="${sc.steps}" var="st">
                                    <div>
                                        <label>Ïä§ÌÖù:
                                            <input type="text" class="st-text" value="${st}"/>
                                        </label>
                                        <button type="button" class="del-step">‚úï</button>
                                    </div>
                                </j:forEach>
                            </div>
                            <button type="button" class="add-step">+ Ïä§ÌÖù Ï∂îÍ∞Ä</button>
                            <button type="button" class="del-scenario">‚úï ÏãúÎÇòÎ¶¨Ïò§ ÏÇ≠Ï†ú</button>
                        </div>
                    </j:forEach>
                </div>

                <!-- ‚ûï JSON Ìé∏ÏßëÏùº ÎïåÎßå ÎÖ∏Ï∂ú -->
                <button type="button" id="addScenario">+ ÏãúÎÇòÎ¶¨Ïò§ Ï∂îÍ∞Ä</button>

                <!-- üìù TXT ÏûÖÎ†• ÏóêÎîîÌÑ∞ (Ï¥àÍ∏∞Ïóî Ïà®ÍπÄ) -->
                <div id="txtEditor" style="display:none; margin-top:20px;">
                    <f:entry title="TXT ÏûÖÎ†•">
                        <f:textarea name="txtContent"
                                    id="txtContent"
                                    style="width:100%; height:200px;">
                        </f:textarea>
                    </f:entry>
                </div>

                <!-- Ïà®Í≤®ÏßÑ Ï†ÄÏû• Îç∞Ïù¥ÌÑ∞ -->
                <input type="hidden" name="jsonData" id="jsonData"/>

                <!-- Ï†ÄÏû• Î≤ÑÌäº -->
                <button type="submit" id="saveButton">Ï†ÄÏû•</button>
            </f:form>

            <!-- ÏÑúÎ≤Ñ Î™®Îç∏ Ï£ºÏûÖ -->
            <script id="modelData" type="application/json">
                ${m.toJson()}
            </script>
        </l:main-panel>
    </l:layout>
</j:jelly>
